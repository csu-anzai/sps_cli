#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""

Cria os diretórios e arquivos de dados conforme a estrutura inicialmente pensadapelo aplicativo.

Usage:
    sps-install ( createdb | config ) 

"""

from docopt import docopt
from subprocess import getoutput

import os

args = docopt(__doc__)

def main():
    if not args['config']:
        check_config = bool(getoutput('if [ -f "$(echo $HOME)/.sps-cli.conf" ]; then echo "True"; else echo "False"; fi'))
        if not check_config:
            print('Arquivo de configuração não foi encontrado...')
            r = input('Deseja criar um agora? [s|n]')
            if r.lower() == 's':
                os.system('sps-install config')
            else:
                exit()

    elif args['config']:
        pass

    elif args['createdb']:
        init_dir = os.getcwd()
        os.chdir(app_root_folder)
        os.mkdir('seguranca')
        os.mkdir('eml-template')
        os.mkdir('dados')
        os.mkdir('dados/fragmentos')
        os.mkdir('dados/indexados')
        os.system('touch dados/atendimentos.json')
        os.system('touch dados/corrigidos.json')
        os.system('touch dados/processos.json')
        os.system('touch dados/profissionais.json')
        os.system('touch dados/usuarios.json')
        os.system('touch dados/estudos.json')
        os.system('touch dados/indexados/index_db.json')
        os.system('touch seguranca/ccrypt-key')
        os.system('if [ $(cat dados/atendimentos.json | wc -l) -lt 2 ]; then echo "[]" > dados/atendimentos.json; fi')
        os.system('if [ $(cat dados/corrigidos.json | wc -l) -lt 2 ]; then echo "[]" > dados/corrigidos.json; fi')
        os.system('if [ $(cat dados/processos.json | wc -l) -lt 2 ]; then echo "[]" > dados/processos.json; fi')
        os.system('if [ $(cat dados/profissionais.json | wc -l) -lt 2 ]; then echo "[]" > dados/profissionais.json; fi')
        os.system('if [ $(cat dados/usuarios.json | wc -l) -lt 2 ]; then echo "[]" > dados/usuarios.json; fi')
        os.system('if [ $(cat dados/estudos.json | wc -l) -lt 2 ]; then echo "[]" > dados/estudos.json; fi')
        os.system('if [ $(cat dados/indexados/index_db.json | wc -l) -lt 2 ]; then echo "[]" > dados/indexados/index_db.json; fi')
        os.system('if [ $(cat seguranca/ccrypt-key | wc -c) -lt 5 ]; then randnum 1024 > seguranca/ccrypt-key; fi')
        os.chdir(init_dir)
    
    

   

if __name__ == '__main__':
    main()
